#!/usr/bin/env node
var args = require('minimist')(process.argv);
var tmuxtdd = require('..');
var path = require('path');
var fs = require('fs');

function run(args) {
  var watch = args.w || args.watch;
  var cmd = args.c || args.cmd;
  if (!cmd) {
    console.log('You must specify a command using -c or --cmd');
    process.exit()
  }
  var autoKill = args.k || args.kill || false;
  tmuxtdd.startRunner(watch, 'bash', ['-c', cmd], autoKill);
}

function help() {
  fs.createReadStream(path.resolve(__dirname, '..', 'help.txt'))
  .pipe(process.stdout)
  .on('done', process.exit)
}

function main(args) {
  if (args.h || args.help) {
    return help();
  } else if (args.status) {
    return tmuxtdd.printStatus()
  } else switch (args._[2]) {
    case 'run':
      return run(args);
    default:
      return help();
  }
}

main(args);
